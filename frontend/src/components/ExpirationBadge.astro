---
import {
  formatTimeRemaining,
  getExpiryUrgency,
  formatExpiryDate,
} from "../utils/time";

interface Props {
  expiryDate: string | Date | null;
  size?: "sm" | "md";
}

const { expiryDate, size = "md" } = Astro.props;

// Don't render if no expiry date
if (!expiryDate) {
  return null;
}

const timeRemaining = formatTimeRemaining(expiryDate);
const urgency = getExpiryUrgency(expiryDate);
const fullDate = formatExpiryDate(expiryDate);

// Don't render if expired
if (!timeRemaining || timeRemaining === "Expired") {
  return null;
}

const sizeClasses =
  size === "sm" ? "text-xs px-2 py-0.5" : "text-sm px-2.5 py-1";

const urgencyColors = {
  critical: "bg-red-500/10 text-red-400 border-red-500/30",
  warning: "bg-orange-500/10 text-orange-400 border-orange-500/30",
  normal: "bg-blue-500/10 text-blue-400 border-blue-500/30",
};

const colorClass = urgency ? urgencyColors[urgency] : urgencyColors.normal;
---

<div
  class={`inline-flex items-center gap-1.5 rounded-full border ${sizeClasses} ${colorClass} font-medium`}
  title={`Deal expires: ${fullDate}`}
>
  <!-- Clock icon -->
  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>
  <span>{timeRemaining}</span>
</div>
